## Source Code Implementation Details

This readme describes on a high level how safrs_rest is implemented (for low level details you can check the code and comments)
This directory contains the code to construct documented REST APIs:
- [config.py](config.py) : Configurable options
- [base.py](base.py) : sqlalchemy model class, most of the model customizations are handled here
- [jsonapi.py](jsonapi.py) : API web bindings. The source code contains a lot of references to the jsonapi specifiation.
- [safrs_types.py](safrs_types.py) : Custome database types (eg. SAFRSSHA256HashID in case you'd like to use a SHA256 hash instead of UUID is primary key)
- [swagger_doc.py](swagger_doc.py) : API documentation, implemented as decorators
- [errors.py](errors.py) : Exceptions

### Variables for SQLAlchemy, Flask Logging

Some variables have to be globally (cross-module) defined:
- app : flask app
- safrs.DB  : flask-sqlalchemy database instance
- safrs.log : python logging instances

### SAFRSBase

A lot of customizations can be implemented by overriding various `SAFRSBase` methods. Most of the methods start with a `_s_` prefix so they wouldn't interfer with sqlalchemy column attributes. Some methods that can be useful to override are:

- \_\_init\_\_
- `to_dict` : return the jsonapi `attributes` dictionary
- `_s_post` : called when an instance is created (with a HTTP POST)
- `_s_patch` : called when an instance is updated (with a HTTP PATCH)
- `_s_parse_attr_value(self, attr_name, attr_val)`: jsonapi attribute-value pair parsing
- `_s_check_perm`: returns a boolean indicating if an attribute can be serialized
- `_s_type` : jsonapi type property
- `_s_count` : jsonapi count value (normally created by sqla `.count()`, but this can be overriden for performance improvement on large (>1G) tables)
- `_s_filter` : called when the jsonapi `filter=` url query parameter is provided for the class

### Api

The flask_restful_swagger_2 Api class has been extended with following methods:
- ```expose_object``` Create endpoints to access the SAFRSBase classes
- ```expose_relationship```

In addition to creating endpoints, these functions also apply the ```api_decorator``` decorators:
- implement cors
- generate swagger documentation
- wrap the implemented HTTP methods (get, post, put, etc. ) to commit to the database after a request and
- implement exception handling

The standard Api ```add_resource``` method has been modified to parse the parameters generated by the SAFRSBase swagger methods.

The Api class is returned by calling the `SAFRSAPI` function.

### SAFRSRestAPI
SAFRSRestAPI is a superclass for dynamically generated flask-restful endpoints.

### SAFRSRestRelationshipAPI

### Swagger Documentation

- ```swagger_doc```
- ```swagger_relationship_doc```

### Serialization

- ```safrs_serialize```
- The restful ```SAFRSJSONEncoder``` class calls the SAFRSBase subclass to_dict method to convert object attributes to a python dictionary which is then converted to JSON.

## Var

I'm pretty happy with the design and quality of code. Given the benefit of hindsight however, a lot of things can be improved :) .
